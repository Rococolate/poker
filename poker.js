'use strict';
const start = Date.now();
const A = ['1A', '2A', '3A', '4A', '5A', '6A', '7A', '8A', '9A', '10A'];
const B = ['1B', '2B', '3B', '4B', '5B', '6B', '7B', '8B', '9B', '10B'];
const C = ['1C', '2C', '3C', '4C', '5C', '6C', '7C', '8C', '9C', '10C'];
const D = ['1D', '2D', '3D', '4D', '5D', '6D', '7D', '8D', '9D', '10D'];
let count = 0;
let clcount = 0;
let answer = [];
let sy = {};
let sy2 = {};

// 遍历所有可能抽到的组合
A.forEach( a => {
  B.forEach( b => {
    C.forEach( c => {
      D.forEach( d => {
        count ++;
        let res = combination24(a, b, c, d);
        if (!!res) answer.push(res);
      });
    });
  }); 
});

let sortArray = answer.map( item => toString(item) ).sort(); 
sortArray.forEach(item => {
  let cleaner = clear(item).split(',').sort();
  if ( sy2[cleaner] === undefined ) sy2[cleaner] = [];
  sy2[cleaner].push(item);
});
// 排序
console.log(answer.length);
console.log(sy);
console.log(sy2);
console.log(count);
console.log(clcount);
console.log(Date.now() - start,'ms');

function search(a,b,c,d){
  var key = [a,b,c,d].sort().join(',');
  return sy2[key];
}

function clear(item){
  return item.replace(/\(|\)/g,'').replace(/-|\*|\+|\//g,',');
}

function syAdd(f){
  let key = f.join(',');
  if (sy[key] === undefined) {
    sy[key] = 0;
  } else {
    sy[key] ++;
  }
}

function toString(str){
  return String(str.replace(/[A-D]/g,''));
}

function toNumber(str){
  return Number(str.replace(/[A-D]/g,''));
}

function combination24 (a, b, c, d) {
  let boolen = false;
  // 组合
  let l1 = [
    [a, b, c, d], [a, b, d, c], [a, c, b, d], [a, c, d, b], [a, d, b, c], [a, d, c, b],
    [b, a, c, d], [b, a, d, c], [b, c, a, d], [b, c, d, a], [b, d, a, c], [b, d, c, a],
    [c, a, b, d], [c, a, d, b], [c, b, a, d], [c, b, d, a], [c, d, a, b], [c, d, b, a],
    [d, a, b, c], [d, a, c, b], [d, b, a, c], [d, b, c, a], [d, c, a, b], [d, c, b, a], 
  ]
  /**/

  let l3 = [ // (( a x b ) x c ) x d
      ['+','+','+'],     ['+','+','-'],     ['+','+','*'],     /*['+','+','/'],*/ 
      ['+','-','+'],   /*['+','-','-'],*/   ['+','-','*'],     /*['+','-','/'],*/
      ['+','*','+'],     ['+','*','-'],     ['+','*','*'],       ['+','*','/'], 
      ['+','/','+'],   /*['+','/','-'],*/   ['+','/','*'],     /*['+','/','/'],*/ 
            
      ['-','+','+'],   /*['-','+','-'],*/   ['-','+','*'],     /*['-','+','/'],*/ 
    /*['-','-','+'],*/ /*['-','-','-'],*/   ['-','-','*'],     /*['-','-','/'],*/
      ['-','*','+'],     ['-','*','-'],     ['-','*','*'],       ['-','*','/'], 
    /*['-','/','+'],*/ /*['-','/','-'],*/   ['-','/','*'],     /*['-','/','/'],*/ 
        
      ['*','+','+'],     ['*','+','-'],     ['*','+','*'],       ['*','+','/'], 
      ['*','-','+'],     ['*','-','-'],     ['*','-','*'],       ['*','-','/'],
      ['*','*','+'],     ['*','*','-'],     ['*','*','*'],       ['*','*','/'],  
      ['*','/','+'],     ['*','/','-'],     ['*','/','*'],       ['*','/','/'],  
          
      ['/','+','+'],   /*['/','+','-'],*/   ['/','+','*'],     /*['/','+','/'],*/ 
    /*['/','-','+'],*/ /*['/','-','-'],*/   ['/','-','*'],     /*['/','-','/'],*/
      ['/','*','+'],     ['/','*','-'],     ['/','*','*'],       ['/','*','/'],  
    /*['/','/','+'],*/ /*['/','/','-'],*/   ['/','/','*'],     /*['/','/','/'],*/ 
  ]


  let l4 = [ // ( a x b ) x ( c x d )
    /*['+','+','+'],*/ /*['+','+','-'],*/ /*['+','+','*'],*/   /*['+','+','/'],*/ 
    /*['+','-','+'],*/ /*['+','-','-'],*/ /*['+','-','*'],*/   /*['+','-','/'],*/
      ['+','*','+'],     ['+','*','-'],   /*['+','*','*'],*/   /*['+','*','/'],*/
    /*['+','/','+'],*/ /*['+','/','-'],*/ /*['+','/','*'],*/   /*['+','/','/'],*/ 
            
    /*['-','+','+'],*/ /*['-','+','-'],*/ /*['-','+','*'],*/   /*['-','+','/'],*/ 
    /*['-','-','+'],*/ /*['-','-','-'],*/ /*['-','-','*'],*/   /*['-','-','/'],*/
      ['-','*','+'],     ['-','*','-'],   /*['-','*','*'],*/   /*['-','*','/'],*/
    /*['-','/','+'],*/ /*['-','/','-'],*/ /*['-','/','*'],*/   /*['-','/','/'],*/ 
        
    /*['*','+','+'],*/ /*['*','+','-'],*/   ['*','+','*'],     /*['*','+','/'],*/ 
    /*['*','-','+'],*/ /*['*','-','-'],*/   ['*','-','*'],       ['*','-','/'],
    /*['*','*','+'],*/ /*['*','*','-'],*/ /*['*','*','*'],*/   /*['*','*','/'],*/
    /*['*','/','+'],*/ /*['*','/','-'],*/ /*['*','/','*'],*/   /*['*','/','/'],*/
          
    /*['/','+','+'],*/ /*['/','+','-'],*/ /*['/','+','*'],*/   /*['/','+','/'],*/ 
    /*['/','-','+'],*/ /*['/','-','-'],*/ /*['/','-','*'],*/   /*['/','-','/'],*/
    /*['/','*','+'],*/ /*['/','*','-'],*/ /*['/','*','*'],*/   /*['/','*','/'],*/
    /*['/','/','+'],*/ /*['/','/','-'],*/ /*['/','/','*'],*/   /*['/','/','/'],*/ 
  ]

  let l5 = [ // ( a x b x c ) x d )
    /*['+','+','+'],*/ /*['+','+','-'],*/ /*['+','+','*'],*/   /*['+','+','/'],*/ 
    /*['+','-','+'],*/ /*['+','-','-'],*/ /*['+','-','*'],*/   /*['+','-','/'],*/
    /*['+','*','+'],*/ /*['+','*','-'],*/   ['+','*','*'],       ['+','*','/'],  
    /*['+','/','+'],*/ /*['+','/','-'],*/   ['+','/','*'],     /*['+','/','/'],*/ 
            
    /*['-','+','+'],*/ /*['-','+','-'],*/ /*['-','+','*'],*/   /*['-','+','/'],*/ 
    /*['-','-','+'],*/ /*['-','-','-'],*/ /*['-','-','*'],*/   /*['-','-','/'],*/
    /*['-','*','+'],*/ /*['-','*','-'],*/   ['-','*','*'],       ['-','*','/'],
    /*['-','/','+'],*/ /*['-','/','-'],*/   ['-','/','*'],     /*['-','/','/'],*/ 
        
    /*['*','+','+'],*/ /*['*','+','-'],*/ /*['*','+','*'],*/   /*['*','+','/'],*/ 
    /*['*','-','+'],*/ /*['*','-','-'],*/ /*['*','-','*'],*/   /*['*','-','/'],*/
    /*['*','*','+'],*/ /*['*','*','-'],*/ /*['*','*','*'],*/   /*['*','*','/'],*/
    /*['*','/','+'],*/ /*['*','/','-'],*/ /*['*','/','*'],*/   /*['*','/','/'],*/
          
    /*['/','+','+'],*/ /*['/','+','-'],*/ /*['/','+','*'],*/   /*['/','+','/'],*/ 
    /*['/','-','+'],*/ /*['/','-','-'],*/ /*['/','-','*'],*/   /*['/','-','/'],*/
    /*['/','*','+'],*/ /*['/','*','-'],*/ /*['/','*','*'],*/   /*['/','*','/'],*/
    /*['/','/','+'],*/ /*['/','/','-'],*/ /*['/','/','*'],*/   /*['/','/','/'],*/ 
  ]

  // 结合
  let o = {};
   o['+,*,+'] = function(a, b, c, d){return (a + b) * (c + d)};
   o['+,*,-'] = function(a, b, c, d){return (a + b) * (c - d)};
   o['-,*,+'] = function(a, b, c, d){return (a - b) * (c + d)};
   o['-,*,-'] = function(a, b, c, d){return (a - b) * (c - d)};
   o['*,+,*'] = function(a, b, c, d){return (a * b) + (c * d)};
  // o['*,+,/'] = function(a, b, c, d){return (a * b) + (c / d)}; // 跑过一次后发现没有
   o['*,-,*'] = function(a, b, c, d){return (a * b) - (c * d)};
   o['*,-,/'] = function(a, b, c, d){return (a * b) - (c / d)};
  // o['/,+,*'] = function(a, b, c, d){return (a / b) + (c * d)}; // 跑过一次后发现没有
  // o['/,-,*'] = function(a, b, c, d){return (a / b) - (c * d)}; // 跑过一次后发现没有
   o['+,*,*'] = function(a, b, c, d){return (a + b * c ) * d};
   o['+,/,*'] = function(a, b, c, d){return (a + b / c ) * d};
   o['+,*,/'] = function(a, b, c, d){return (a + b * c ) / d};
   o['-,*,*'] = function(a, b, c, d){return (a - b * c ) * d};
   o['-,/,*'] = function(a, b, c, d){return (a - b / c ) * d};
   o['-,*,/'] = function(a, b, c, d){return (a - b * c ) / d};

  
  l1.forEach( n => {
    if (!!boolen) return ;
    // (( a x b ) x c ) x d
    l3.forEach( f => {
      if (!!boolen) return ;
      let expression = "(("+String(n[0])+f[0]+String(n[1])+")"+f[1]+String(n[2])+")"+f[2]+String(n[3]);
      let i = 0;
      let e = [toNumber(n[0]), toNumber(n[1]), toNumber(n[2]), toNumber(n[3])].reduce((pre, cur) => {
        i ++;
        return calc(f, i, pre, cur);
      });
      // console.log(expression +' : '+e);  
      boolen = is24(e, f, expression);
    });

    if (!!boolen) return ;
    // ( a x b ) x ( c x d )
    l4.forEach( f => {
      if (!!boolen) return ;
      let expression = "("+String(n[0])+f[0]+String(n[1])+")"+f[1]+"("+String(n[2])+f[2]+String(n[3])+")";
      let e = o[f.join(',')].apply(null,[toNumber(n[0]), toNumber(n[1]), toNumber(n[2]), toNumber(n[3])]);
      // console.log(expression +' : '+e); 
      boolen = is24(e, ['('+f[0]+')',f[1],'('+f[2]+')'], expression); 
    });

    if (!!boolen) return ;
    // ( a x b x c ) x d )
    l5.forEach( f => {
      if (!!boolen) return ;
      let expression = "("+String(n[0])+f[0]+String(n[1])+f[1]+String(n[2])+")"+f[2]+String(n[3]);
      let e = o[f.join(',')].apply(null,[toNumber(n[0]), toNumber(n[1]), toNumber(n[2]), toNumber(n[3])]);
      // console.log(expression +' : '+e); 
      boolen = is24(e, ['('+f[0],f[1]+')',f[2]], expression); 
    });
  });

  function is24(e, f, expression){
    clcount ++;
    if ( e / 24 === 1 && e % 24 < 0.000001 ) {
      syAdd(f);
      return expression;
    } else {
      return false;
    }
  }

  function calc(array, type, pre, cur){
    let t = array[ type - 1 ];
    if (t === '+' ) return pre + cur; 
    if (t === '-' ) return pre - cur; 
    if (t === '*' ) return pre * cur; 
    if (t === '/' ) return pre / cur; 
  }

  return boolen;
}